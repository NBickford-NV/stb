/* https://github.com/nothings/stb/issues/1838#issuecomment-3301959868 */

#include "../../stb_image.h"

int test_1838_gif()
{
	const stbi_uc data[] = {
		0x47, 0x49, 0x46, 0x38, 0x37, 0x61, 0x00, 0x00, 0x01, 0x7F, 0x00, 0x00,
		0x00, 0x2C, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0xE8, 0x00,
		0x00, 0x00, 0x64, 0xE9, 0x83, 0x00, 0x00, 0x21, 0xF9, 0x04, 0x01, 0x00,
		0xFF, 0x76, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00,
		0xE8, 0xFF, 0x17, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x01, 0x01, 0x18, 0x7F
	};
	int size = (int)sizeof(data);

	int* delays = NULL;
	int x, y, z, comp;
	stbi_uc* image = stbi_load_gif_from_memory(data, size, &delays, &x, &y, &z, &comp, 0);
	// In an unpatched version AddressSanitizer reports a double-free
	// in stbi_load_gif_from_memory.

	if (image)
	{
		stbi_image_free(image);
	}

	if (delays)
	{
		stbi_image_free(delays);
	}

	return EXIT_SUCCESS;
}
